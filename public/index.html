<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <title>Sauki Data</title>
  
  <script src="https://checkout.flutterwave.com/v3.js"></script>
  
  <style>
    /* --- iOS 26 Single-Screen Concept --- */
    :root {
      --bg-gradient: linear-gradient(135deg, #e0eafc 0%, #cfdef3 100%);
      --glass-surface: rgba(255, 255, 255, 0.55);
      --glass-border: rgba(255, 255, 255, 0.4);
      --primary: #007AFF;
      --text-dark: #1d1d1f;
      --text-gray: #86868b;
      --radius-l: 26px;
      --radius-m: 18px;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", sans-serif;
      background: var(--bg-gradient);
      color: var(--text-dark);
      height: 100vh;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      padding-bottom: env(safe-area-inset-bottom);
    }

    /* 1. Status Bar */
    .status-bar {
      height: 44px;
      padding: 0 20px;
      padding-top: max(5px, env(safe-area-inset-top));
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.75rem;
      font-weight: 600;
      color: var(--text-gray);
      z-index: 10;
    }
    .status-pill {
      background: rgba(255,255,255,0.4);
      padding: 4px 12px;
      border-radius: 20px;
      backdrop-filter: blur(10px);
    }

    /* 2. Main Container */
    .app-screen {
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: space-evenly; 
      padding: 10px 24px;
      max-width: 500px;
      margin: 0 auto;
      width: 100%;
    }

    /* Header */
    .header { display: flex; align-items: center; gap: 12px; margin-bottom: 10px; }
    .header img { width: 44px; height: 44px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
    .brand-name { font-weight: 800; font-size: 1.2rem; letter-spacing: -0.5px; }

    /* Hero */
    .hero { text-align: center; }
    .hero h2 { font-size: 1.8rem; font-weight: 800; line-height: 1.1; margin-bottom: 5px; background: -webkit-linear-gradient(90deg, #333, #000); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    .hero p { font-size: 0.9rem; color: var(--text-gray); }

    /* Network Row */
    .network-row {
      display: flex;
      justify-content: space-between;
      gap: 12px;
    }
    .net-card {
      flex: 1;
      background: var(--glass-surface);
      border: 1px solid var(--glass-border);
      backdrop-filter: blur(20px);
      padding: 15px 10px;
      border-radius: var(--radius-m);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 20px rgba(0,0,0,0.02);
      transition: transform 0.2s;
      cursor: pointer;
    }
    .net-card:active { transform: scale(0.95); background: rgba(255,255,255,0.8); }
    .net-card img { width: 45px; height: 45px; margin-bottom: 8px; object-fit: contain; }
    .net-card span { font-weight: 600; font-size: 0.85rem; }

    /* Action Buttons */
    .action-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    .btn-glass {
      background: rgba(255,255,255,0.35);
      border: 1px solid rgba(255,255,255,0.5);
      padding: 14px;
      border-radius: var(--radius-m);
      font-weight: 600;
      color: var(--primary);
      display: flex; align-items: center; justify-content: center; gap: 8px;
      font-size: 0.9rem;
      cursor: pointer;
    }

    /* Floating Styled Footer */
    .floating-footer {
      background: rgba(255, 255, 255, 0.45);
      backdrop-filter: blur(25px);
      -webkit-backdrop-filter: blur(25px);
      border: 1px solid rgba(255, 255, 255, 0.6);
      border-radius: 28px;
      padding: 15px;
      text-align: center;
      box-shadow: 0 10px 40px rgba(0,0,0,0.05);
      margin-top: 10px;
    }
    .footer-icons img { height: 24px; margin: 0 8px; opacity: 0.8; }
    .footer-text { font-size: 0.7rem; color: var(--text-gray); margin-top: 5px; font-weight: 500; }

    /* Modal Sheet */
    .modal-overlay {
      position: fixed; inset: 0; background: rgba(0,0,0,0.1); backdrop-filter: blur(5px);
      z-index: 2000; display: none; align-items: flex-end; justify-content: center;
    }
    .modal-overlay.active { display: flex; }
    .sheet {
      background: #fff; width: 100%; max-width: 500px;
      border-radius: 32px 32px 0 0;
      padding: 24px;
      box-shadow: 0 -10px 50px rgba(0,0,0,0.15);
      animation: slideUp 0.35s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      max-height: 85vh; overflow-y: auto;
    }
    @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }

    /* Sheet Elements */
    .sheet-handle { width: 40px; height: 5px; background: #e5e5ea; border-radius: 10px; margin: 0 auto 20px; }
    .input-field { width: 100%; padding: 16px; background: #f2f2f7; border: none; border-radius: 16px; margin-bottom: 12px; font-size: 1rem; outline: none; }
    .btn-primary { width: 100%; padding: 18px; background: var(--primary); color: #fff; border: none; border-radius: 18px; font-weight: 700; font-size: 1rem; cursor: pointer; box-shadow: 0 8px 20px rgba(0,122,255,0.25); }
    .btn-secondary { width: 100%; padding: 16px; background: transparent; color: var(--text-gray); border: none; font-weight: 600; cursor: pointer; margin-top: 5px; }
    
    .plan-list-item {
      display: flex; justify-content: space-between; padding: 16px;
      border-bottom: 1px solid #f5f5f5; cursor: pointer;
    }
    .plan-list-item:last-child { border-bottom: none; }

    .loader { width: 24px; height: 24px; border: 3px solid #eee; border-top-color: var(--primary); border-radius: 50%; animation: spin 0.8s infinite linear; margin: 0 auto; }
    @keyframes spin { to { transform: rotate(360deg); } }
  </style>
</head>
<body>

  <!-- Status Bar -->
  <div class="status-bar">
    <div class="status-pill">
      <span style="font-size:12px">saukidatalinks@gmail.com</span>
    </div>
    <div style="display:flex; gap:15px;">
      <a href="tel:08164135836" style="color:var(--primary); text-decoration:none">Call</a>
      <a href="https://wa.me/2348164135836" style="color:var(--primary); text-decoration:none">WhatsApp</a>
    </div>
  </div>

  <!-- App Content -->
  <div class="app-screen">
    
    <!-- Header -->
    <div class="header">
      <img src="logo.png" alt="Logo" onerror="this.src='https://via.placeholder.com/44'">
      <div>
        <div class="brand-name">Sauki Data</div>
        <div style="font-size:0.75rem; color:var(--text-gray); font-weight:500;">Government Certified by SMEDAN</div>
      </div>
    </div>

    <!-- Hero -->
    <div class="hero">
      <h2>The Smartest Way<br>to Buy Data.</h2>
      <p>Cheaper rates. Simpler process.<br>Instant Delivery.</p>
    </div>

    <!-- Networks -->
    <div class="network-row">
      <div class="net-card" onclick="fetchPlans('mtn')">
        <img src="mtn.png" alt="MTN" onerror="this.style.background='#FFCC00'">
        <span>MTN</span>
      </div>
      <div class="net-card" onclick="fetchPlans('glo')">
        <img src="glo.png" alt="Glo" onerror="this.style.background='#00C300'">
        <span>Glo</span>
      </div>
      <div class="net-card" onclick="fetchPlans('airtel')">
        <img src="airtel.png" alt="Airtel" onerror="this.style.background='#FF0000'">
        <span>Airtel</span>
      </div>
    </div>

    <!-- Actions -->
    <div class="action-grid">
      <div class="btn-glass" onclick="openGiveaway()">
        <span>üéÅ</span> Giveaway
      </div>
      <div class="btn-glass" onclick="subscribe()">
        <span>üîî</span> Alerts
      </div>
    </div>

    <!-- Floating Footer -->
    <div class="floating-footer">
      <div class="footer-icons">
        <img src="smedan.png" alt="SMEDAN" onerror="this.style.display='none'">
        <img src="coat.png" alt="NIGERIA" onerror="this.style.display='none'">
      </div>
      <div class="footer-text">
        &copy; 2025 Sauki Data Links<br>
        Developed with ‚ù§Ô∏è by Abdallah Nangere
      </div>
    </div>

  </div>

  <!-- Sheets -->
  <div class="modal-overlay" id="modal-overlay">
    <div class="sheet">
      <div class="sheet-handle"></div>
      <div id="sheet-content"></div>
    </div>
  </div>

  <script>
    // CONFIG
    const FLW_PUBLIC_KEY = "FLWPUBK-ab3c49ed8e4056a8762fb6c6fbb68a83-X"; 
    const ADMIN_CONTACT = "2348164135836";
    let currentPlan = {};

    // --- RECOVERY ---
    window.addEventListener('load', () => {
        const p = localStorage.getItem('sauki_pend');
        if(p) {
            const d = JSON.parse(p);
            if(Date.now() - d.t < 900000) openRecover(d);
            else localStorage.removeItem('sauki_pend');
        }
    });

    function openRecover(d) {
        showSheet(`
            <h3 style="text-align:center; margin-bottom:10px">Resume Transaction?</h3>
            <p style="text-align:center; color:#666; margin-bottom:20px">Purchase for ${d.ph} was interrupted.</p>
            <button class="btn-primary" onclick="verify('${d.ref}', true)">Check Status</button>
            <button class="btn-secondary" onclick="localStorage.removeItem('sauki_pend'); closeSheet()">Cancel</button>
        `);
    }

    // --- APP LOGIC ---
    async function fetchPlans(net) {
        showSheet(`<div class="loader"></div><p style="text-align:center; margin-top:10px">Loading ${net}...</p>`);
        try {
            const res = await fetch(`/api/plans?network=${net}`);
            const plans = await res.json();
            
            if(!plans.length) {
                showSheet(`<h3 style="text-align:center">No Plans</h3><button class="btn-secondary" onclick="closeSheet()">Back</button>`);
                return;
            }

            let html = `<h3 style="text-align:center; margin-bottom:20px">${net.toUpperCase()} Plans</h3>`;
            html += `<div style="max-height:50vh; overflow-y:auto">`;
            html += plans.map(p => `
                <div class="plan-list-item" onclick="buy('${p.id}', '${p.name}', ${p.price}, '${net}')">
                    <b>${p.name}</b>
                    <span style="color:var(--primary)">‚Ç¶${p.price}</span>
                </div>
            `).join('');
            html += `</div>`;
            html += `<button class="btn-secondary" onclick="closeSheet()">Back</button>`;
            showSheet(html);
        } catch(e) {
            showSheet(`<p style="text-align:center; color:red">Connection Failed</p><button class="btn-secondary" onclick="closeSheet()">Back</button>`);
        }
    }

    function buy(id, name, price, net) {
        currentPlan = { id, name, price, net };
        showSheet(`
            <h3 style="text-align:center">‚Ç¶${price}</h3>
            <p style="text-align:center; color:#888; margin-bottom:20px">${net.toUpperCase()} ${name}</p>
            <input class="input-field" id="u-ph" type="tel" placeholder="Phone Number (080...)" maxlength="11">
            <input class="input-field" id="u-nm" placeholder="Your Name">
            <div style="display:flex; align-items:center; gap:10px; margin-bottom:20px; padding-left:5px">
                <input type="checkbox" id="u-pt" style="transform:scale(1.2)"> <label>Ported Number?</label>
            </div>
            <button class="btn-primary" onclick="pay()">Pay Securely</button>
            <button class="btn-secondary" onclick="fetchPlans('${net}')">Back</button>
        `);
    }

    function pay() {
        const ph = document.getElementById('u-ph').value;
        const nm = document.getElementById('u-nm').value;
        const pt = document.getElementById('u-pt').checked;
        
        if(ph.length < 10 || !nm) return alert("Invalid Details");

        if(currentPlan.net === 'airtel') {
            window.location = `https://wa.me/${ADMIN_CONTACT}?text=Buy Airtel ${currentPlan.name} for ${ph}`;
            return;
        }

        const ref = `Sauki-${ph}-${Date.now()}`;
        localStorage.setItem('sauki_pend', JSON.stringify({ ref, ph, id: currentPlan.id, net: currentPlan.net, pt, t: Date.now() }));

        FlutterwaveCheckout({
            public_key: FLW_PUBLIC_KEY,
            tx_ref: ref,
            amount: currentPlan.price,
            currency: "NGN",
            payment_options: "card,banktransfer,ussd",
            redirect_url: window.location.href,
            customer: { email: "saukidatalinks@gmail.com", phone_number: ph, name: nm },
            customizations: { title: "Abdullahi Adam Usman FLW", logo: "https://saukidata.vercel.app/logo.png" },
            callback: (d) => verify(d.transaction_id || ref)
        });
    }

    // Redirect Handler
    const url = new URLSearchParams(window.location.search);
    if(url.has('status') && (url.get('status') === 'successful' || url.get('status') === 'completed')) {
        window.history.replaceState({},'', '/');
        verify(url.get('transaction_id') || url.get('tx_ref'));
    }

    async function verify(txId, isRec = false) {
        showSheet(`<div class="loader"></div><p style="text-align:center; margin-top:10px">Verifying...</p>`);
        
        let d = isRec ? JSON.parse(localStorage.getItem('sauki_pend')) : {
            ph: document.getElementById('u-ph').value,
            id: currentPlan.id,
            net: currentPlan.net,
            pt: document.getElementById('u-pt').checked
        };
        
        if(!d || !d.ph) d = JSON.parse(localStorage.getItem('sauki_pend'));

        try {
            const res = await fetch('/api/purchase', {
                method: 'POST',
                headers: {'Content-Type':'application/json'},
                body: JSON.stringify({
                    transaction_id: txId,
                    mobile_number: d.ph,
                    plan_id: d.id,
                    network: d.net,
                    ported: d.pt
                })
            });
            const resp = await res.json();
            localStorage.removeItem('sauki_pend');

            if(resp.success) {
                showSheet(`
                    <div style="text-align:center">
                        <div style="font-size:50px; margin-bottom:10px">‚úÖ</div>
                        <h2 style="margin-bottom:10px">Success!</h2>
                        <p style="color:#666; margin-bottom:20px">Data sent to ${d.ph}</p>
                        <button class="btn-primary" onclick="closeSheet()">Done</button>
                    </div>
                `);
            } else {
                let msg = resp.error;
                if(msg.includes('Provider') || msg.includes('API')) msg = "Network is down now, but you will be credited immediately it is back.";
                
                const supportMsg = `Transaction Failed details:%0A%0ARef: ${txId}%0APhone: ${d.ph}%0APlan: ${d.id}%0AReason: ${resp.error}`;
                
                showSheet(`
                    <div style="text-align:center">
                        <div style="font-size:50px; margin-bottom:10px">‚ö†Ô∏è</div>
                        <h3 style="margin-bottom:10px; color:#FF3B30">Processing...</h3>
                        <p style="color:#666; margin-bottom:20px">${msg}</p>
                        <button class="btn-secondary" style="width:100%" onclick="window.location='https://wa.me/${ADMIN_CONTACT}?text=${supportMsg}'">Contact Admin</button>
                        <button class="btn-primary" style="margin-top:10px; background:#8E8E93" onclick="closeSheet()">Close</button>
                    </div>
                `);
            }
        } catch(e) {
            showSheet(`<p style="text-align:center">Network Error</p><button class="btn-secondary" onclick="closeSheet()">Back</button>`);
        }
    }

    // UTILS
    function showSheet(html) {
        document.getElementById('sheet-content').innerHTML = html;
        document.getElementById('modal-overlay').classList.add('active');
    }
    function closeSheet() { document.getElementById('modal-overlay').classList.remove('active'); }
    
    function openGiveaway() {
        showSheet(`
            <h3 style="text-align:center; margin-bottom:15px">üéÅ Giveaway Entry</h3>
            
            <select class="input-field" id="g-net">
                <option value="MTN">MTN</option>
                <option value="GLO">Glo</option>
                <option value="AIRTEL">Airtel</option>
            </select>
            
            <input class="input-field" id="g-p" placeholder="Phone Number" type="tel">
            <input class="input-field" id="g-k" placeholder="Giveaway Code">
            
            <button class="btn-primary" onclick="submitGiveaway()">Submit Entry</button>
            <button class="btn-secondary" onclick="closeSheet()">Back</button>
        `);
    }

    function submitGiveaway() {
        const net = document.getElementById('g-net').value;
        const ph = document.getElementById('g-p').value;
        const code = document.getElementById('g-k').value;
        
        if(!ph || !code) return alert("Please fill all fields");
        
        const text = `Giveaway Entry:%0ANetwork: ${net}%0APhone: ${ph}%0ACode: ${code}`;
        window.location.href = `https://wa.me/${ADMIN_CONTACT}?text=${text}`;
    }

    function subscribe() { window.location = `https://wa.me/${ADMIN_CONTACT}?text=Subscribe`; }
  </script>
</body>
</html>


