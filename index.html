<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, user-scalable=no">
  <meta name="description" content="Sauki Data Links - Cheapest and Fastest Data in Nigeria.">
  <meta name="theme-color" content="#ffffff">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <title>Sauki Data Links</title>
  <!-- Flutterwave Script -->
  <script src="https://checkout.flutterwave.com/v3.js"></script>
  
  <style>
    /* iOS Design System */
    *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
    :root { 
      --primary: #000; 
      --bg: #f2f2f7; 
      --white: #fff; 
      --blue: #007AFF; 
      --green: #34C759; 
      --border: #c6c6c8;
      --wrapper-max-width: 480px; /* Enforce Mobile Width */
    }
    
    body { 
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", sans-serif; 
      background: #e5e5e5; /* Darker bg for desktop context */
      margin: 0; 
      color: #1c1c1e; 
      display: flex;
      justify-content: center;
      min-height: 100vh;
    }

    /* Mobile Wrapper - Makes it look like an app */
    .mobile-wrapper {
      width: 100%;
      max-width: var(--wrapper-max-width);
      background: var(--bg);
      min-height: 100vh;
      position: relative;
      padding-top: 60px;
      box-shadow: 0 0 20px rgba(0,0,0,0.1);
      overflow-x: hidden;
    }

    /* Navigation */
    .navbar { 
      position: absolute; /* Relative to wrapper */
      top: 0; left: 0; right: 0; 
      height: 60px; 
      background: rgba(255,255,255,0.9); 
      backdrop-filter: blur(10px); 
      border-bottom: 1px solid var(--border); 
      display: flex; 
      justify-content: space-between; 
      align-items: center; 
      padding: 0 20px; 
      z-index: 1000; 
    }
    .nav-logo { font-weight: 700; font-size: 1.1rem; color: #000; text-decoration: none; }
    .nav-links a { color: var(--blue); text-decoration: none; font-size: 0.95rem; font-weight: 500; cursor: pointer; }

    .container { padding: 20px; }
    .hero { text-align: center; margin-bottom: 30px; margin-top: 10px; }
    .hero h1 { margin-bottom: 5px; font-size: 28px; letter-spacing: -0.5px; }
    .hero p { color: #8e8e93; font-size: 15px; }

    /* Cards */
    .grid { display: grid; gap: 16px; }
    .card { 
      background: var(--white); 
      padding: 20px; 
      border-radius: 18px; 
      box-shadow: 0 1px 3px rgba(0,0,0,0.05); 
      transition: 0.2s; 
      cursor: pointer; 
      display: flex; 
      justify-content: space-between; 
      align-items: center; 
      -webkit-tap-highlight-color: transparent;
    }
    .card:active { transform: scale(0.97); background: #f2f2f7; }
    .card-icon { width: 44px; height: 44px; background: #f2f2f7; border-radius: 12px; display: flex; align-items: center; justify-content: center; margin-right: 15px; font-size: 1.3rem; }
    
    /* Buttons & Inputs */
    .btn { background: var(--blue); color: white; border: none; padding: 18px; width: 100%; border-radius: 16px; font-size: 17px; font-weight: 600; margin-top: 20px; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; }
    .btn:active { opacity: 0.8; }
    .btn-green { background: var(--green); }
    
    .input { 
      width: 100%; padding: 16px; 
      background: #fff; border: 1px solid var(--border); 
      border-radius: 12px; font-size: 16px; margin-bottom: 12px; 
      box-sizing: border-box; 
      appearance: none; -webkit-appearance: none;
    }
    .input:focus { border-color: var(--blue); outline: none; }

    /* Modals */
    .modal { position: absolute; inset: 0; background: rgba(0,0,0,0.5); z-index: 2000; display: none; align-items: flex-end; justify-content: center; }
    .modal.active { display: flex; }
    .sheet { 
      background: #fff; 
      width: 100%; 
      border-radius: 24px 24px 0 0; 
      padding: 30px 24px 50px; 
      animation: slideUp 0.3s cubic-bezier(0.2, 0.8, 0.2, 1); 
      max-height: 90vh; 
      overflow-y: auto; 
    }
    @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }

    /* Loaders */
    .spinner { width: 28px; height: 28px; border: 3px solid #ddd; border-top-color: var(--blue); border-radius: 50%; animation: spin 0.8s infinite linear; margin: 0 auto; }
    @keyframes spin { to { transform: rotate(360deg); } }
    
    .loading-overlay { text-align: center; padding: 40px 0; }
    .loading-text { margin-top: 15px; font-weight: 500; color: #555; }
  </style>
</head>
<body>

<div class="mobile-wrapper">
  <nav class="navbar">
    <a href="#" class="nav-logo">Sauki Data</a>
    <div class="nav-links">
      <a onclick="document.getElementById('contact-section').scrollIntoView({behavior: 'smooth'})">Contact</a>
    </div>
  </nav>

  <div class="container">
    <div class="hero">
      <h1>Buy Cheap Data</h1>
      <p>Instant Delivery &bull; Automated</p>
    </div>

    <div class="grid">
      <!-- Network Cards -->
      <div class="card" onclick="fetchPlans('mtn')">
        <div style="display:flex; align-items:center;">
          <div class="card-icon" style="color:#FFcc00; background:#FFFBE6;"><b>M</b></div>
          <div><b>MTN Data</b><br><small style="color:#8e8e93">SME & Gifting</small></div>
        </div>
        <span style="color:#c7c7cc">‚Ä∫</span>
      </div>

      <div class="card" onclick="fetchPlans('glo')">
        <div style="display:flex; align-items:center;">
          <div class="card-icon" style="color:#34C759; background:#E6F9EB;"><b>G</b></div>
          <div><b>Glo Data</b><br><small style="color:#8e8e93">Corporate</small></div>
        </div>
        <span style="color:#c7c7cc">‚Ä∫</span>
      </div>

      <div class="card" onclick="fetchPlans('airtel')">
        <div style="display:flex; align-items:center;">
          <div class="card-icon" style="color:#FF3B30; background:#FFE6E6;"><b>A</b></div>
          <div><b>Airtel Data</b><br><small style="color:#8e8e93">Best Offers</small></div>
        </div>
        <span style="color:#c7c7cc">‚Ä∫</span>
      </div>

      <!-- Giveaway -->
      <div class="card" style="background:#EBF3FF; border:1px solid #007AFF;" onclick="openGiveaway()">
        <div style="display:flex; align-items:center;">
          <div class="card-icon" style="background:#fff; color:#007AFF">üéÅ</div>
          <div style="color:#007AFF"><b>Giveaway</b><br><small>Win Free Data</small></div>
        </div>
        <span style="color:#007AFF">‚Ä∫</span>
      </div>
    </div>

    <!-- Contact & Subscribe -->
    <div class="grid" id="contact-section" style="margin-top: 40px;">
      <h3 style="margin-bottom: 5px; padding-left: 5px; font-size: 1.1rem;">Support</h3>
      
      <div class="card" onclick="window.open('https://wa.me/2348164135836')">
        <div style="display:flex; align-items:center;">
          <div class="card-icon">üìû</div>
          <div><b>WhatsApp</b><br><small>08164135836</small></div>
        </div>
      </div>

      <div class="card" onclick="window.open('https://mail.google.com/mail/?view=cm&fs=1&to=saukidatalinks@gmail.com')">
        <div style="display:flex; align-items:center;">
          <div class="card-icon">‚úâÔ∏è</div>
          <div><b>Email Us</b><br><small style="font-weight:500;">saukidatalinks@gmail.com</small></div>
        </div>
      </div>

      <div class="card" onclick="subscribe()">
        <div style="display:flex; align-items:center;">
          <div class="card-icon">üîî</div>
          <div><b>Subscribe</b><br><small>Get Updates via WhatsApp</small></div>
        </div>
      </div>
    </div>
    
    <p style="text-align:center; color:#8e8e93; margin-top:40px; font-size:12px; padding-bottom: 20px;">&copy; 2025 Sauki Data Links</p>
  </div>

  <!-- Modal Structure -->
  <div class="modal" id="modal" onclick="if(event.target===this)closeModal()">
    <div class="sheet" id="sheet-content"></div>
  </div>
</div>

<script>
  // CONFIG
  const FLW_PUBLIC_KEY = "FLWPUBK-6f70b3b654f142ff792f97ec780be79f-X"; // Check for spaces!
  const ADMIN_WHATSAPP = "2348164135836";
  
  let selected = {};

  // 1. Fetch Plans
  async function fetchPlans(network) {
    showSheet(`
      <div class="loading-overlay">
        <div class="spinner"></div>
        <div class="loading-text">Loading ${network.toUpperCase()} Plans...</div>
      </div>
    `);
    
    try {
      const res = await fetch(`/api/plans?network=${network}`);
      const plans = await res.json();
      
      if(plans.length === 0) {
        showSheet(`<h3>${network.toUpperCase()}</h3><p>No plans available. <a href="https://wa.me/${ADMIN_WHATSAPP}" style="color:blue">Contact Admin</a></p>`);
        return;
      }

      const list = plans.map(p => `
        <div onclick="selectPlan('${p.id}', ${p.price}, '${p.name}', '${network}')" 
             style="padding:16px; border-bottom:1px solid #eee; display:flex; justify-content:space-between; align-items:center; cursor:pointer">
          <span style="font-size:16px; font-weight:500">${p.name}</span>
          <span style="font-weight:600; background:#f2f2f7; padding:6px 12px; border-radius:8px;">‚Ç¶${p.price}</span>
        </div>
      `).join('');
      
      showSheet(`
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
          <h2 style="margin:0; font-size:1.4rem;">${network.toUpperCase()} Plans</h2>
          <button onclick="closeModal()" style="border:none; background:none; font-size:28px; color:#888">&times;</button>
        </div>
        ${list}
      `);
    } catch(e) {
      showSheet(`<p style="color:red; text-align:center">Failed to load plans. Please check connection.</p>`);
    }
  }

  function selectPlan(id, price, name, network) {
    selected = { id, price, name, network };
    showSheet(`
      <h3 style="margin-bottom:5px">Confirm Order</h3>
      <p style="color:#666; margin-bottom:25px;">${network.toUpperCase()} ${name} &bull; <b style="color:#000">‚Ç¶${price}</b></p>
      
      <label style="font-size:13px; color:#666; margin-left:4px;">Your Name</label>
      <input class="input" id="c-name" placeholder="e.g. Abdallah">
      
      <label style="font-size:13px; color:#666; margin-left:4px;">Beneficiary Phone</label>
      <input class="input" type="tel" id="c-phone" placeholder="e.g. 08012345678">
      
      <div style="display:flex; gap:12px; align-items:center; margin:15px 0; background:#f9f9f9; padding:10px; border-radius:10px;">
        <input type="checkbox" id="c-ported" style="width:22px; height:22px">
        <label for="c-ported" style="font-size:15px;">Is this a ported number?</label>
      </div>

      <button class="btn btn-green" onclick="initiatePay()">
        <span>Pay ‚Ç¶${price}</span>
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M5 12h14M12 5l7 7-7 7"/></svg>
      </button>
    `);
  }

  function initiatePay() {
    const name = document.getElementById('c-name').value;
    const phone = document.getElementById('c-phone').value;
    const ported = document.getElementById('c-ported').checked;

    if(!name || !phone) return alert("Please fill all fields");

    selected.phone = phone.replace(/\s/g,'');
    if (selected.phone.startsWith("0")) selected.phone = selected.phone.substring(1);
    const finalPhone = "0" + selected.phone; // Standardize

    selected.name = name;
    selected.ported = ported;

    // FIX: Show loading state INSTEAD of closing modal immediately
    showSheet(`
      <div class="loading-overlay">
        <div class="spinner"></div>
        <div class="loading-text">Redirecting to Payment Gateway...</div>
        <p style="font-size:13px; color:#999; margin-top:10px;">Please wait securely.</p>
      </div>
    `);

    if(selected.network === 'airtel') {
        setTimeout(() => {
            window.location.href = `https://wa.me/${ADMIN_WHATSAPP}?text=I want to buy Airtel Data manually.`;
        }, 1500);
        return;
    }

    try {
        FlutterwaveCheckout({
          public_key: FLW_PUBLIC_KEY.trim(),
          tx_ref: "SAUKI-" + Date.now(),
          amount: selected.price,
          currency: "NGN",
          payment_options: "banktransfer, card, ussd",
          customer: { 
              email: "saukidatalinks@gmail.com", 
              phone_number: finalPhone, 
              name: selected.name 
          },
          customizations: { 
              title: "Abdullahi Adam Usman", 
              description: `Payment for ${selected.name}`,
              logo: "https://ordersauki.vercel.app/logo.png" 
          },
          callback: function(data) {
            // Payment Success: Now we verify
            verifyOrder(data.transaction_id);
          },
          onclose: function() {
            // If user closes Flutterwave without paying, close our loading modal
            closeModal();
          }
        });
    } catch(err) {
        alert("Payment Error: " + err.message);
        closeModal();
    }
  }

  async function verifyOrder(txId) {
    showSheet(`
      <div class="loading-overlay">
        <div class="spinner"></div>
        <div class="loading-text">Verifying Payment...</div>
        <p style="font-size:13px; color:#666; margin-top:5px;">Sending your data now.</p>
      </div>
    `);
    
    try {
      const res = await fetch('/api/purchase', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({
          transaction_id: txId,
          plan_id: selected.id,
          mobile_number: "0" + selected.phone,
          network: selected.network,
          ported: selected.ported
        })
      });
      const data = await res.json();
      
      if(data.success) {
        showSheet(`
          <div style="text-align:center; padding:30px 10px;">
            <div style="width:60px; height:60px; background:#E6F9EB; border-radius:50%; display:flex; align-items:center; justify-content:center; margin:0 auto 20px;">
              <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#34C759" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg>
            </div>
            <h2 style="margin-bottom:10px;">Successful!</h2>
            <p style="color:#666; margin-bottom:25px;">${data.message}</p>
            <button class="btn" onclick="closeModal()">Done</button>
          </div>
        `);
      } else {
        showSheet(`
            <div style="text-align:center; padding:30px 10px;">
                <h3 style="color:#FF3B30">Transaction Note</h3>
                <p style="margin:15px 0; color:#666;">${data.error}</p>
                <button class="btn" onclick="window.open('https://wa.me/${ADMIN_WHATSAPP}?text=Order Failed ID: ${txId}')">Contact Support</button>
                <button class="btn btn-secondary" style="background:#f2f2f7; color:#000; margin-top:10px;" onclick="closeModal()">Close</button>
            </div>
        `);
      }
    } catch(e) {
      showSheet(`<p style="text-align:center; padding:20px;">Network Error. Transaction ID: ${txId}</p>`);
    }
  }

  // --- Utilities ---
  function subscribe() { 
      const msg = "Hello Sauki Data Links, I want to subscribe for updates.";
      window.location.href = `https://wa.me/${ADMIN_WHATSAPP}?text=${encodeURIComponent(msg)}`; 
  }
  
  function openGiveaway() {
    showSheet(`
      <h3 style="margin-bottom:15px; color:#007AFF">üéÅ Data Giveaway</h3>
      <input class="input" id="g-phone" placeholder="Your Phone Number">
      <input class="input" id="g-key" placeholder="Giveaway Key (e.g. SAUKI2025)">
      <select class="input" id="g-net"><option>MTN</option><option>Glo</option><option>Airtel</option></select>
      <button class="btn" onclick="submitGiveaway()">Submit Entry via WhatsApp</button>
    `);
  }

  function submitGiveaway() {
    const p = document.getElementById('g-phone').value;
    const k = document.getElementById('g-key').value;
    const n = document.getElementById('g-net').value;
    if(!p || !k) return alert("Fill all fields");
    
    const msg = `*Giveaway Entry* üéÅ\n\nPhone: ${p}\nNetwork: ${n}\nKey: ${k}`;
    window.location.href = `https://wa.me/${ADMIN_WHATSAPP}?text=${encodeURIComponent(msg)}`;
  }

  function showSheet(html) { document.getElementById('sheet-content').innerHTML = html; document.getElementById('modal').classList.add('active'); }
  function closeModal() { document.getElementById('modal').classList.remove('active'); }
</script>
</body>
</html>



