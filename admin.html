<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sauki Admin</title>
  <style>
    body { font-family: sans-serif; background: #f4f4f4; padding: 20px; }
    .container { max-width: 800px; margin: 0 auto; background: #fff; padding: 20px; border-radius: 8px; }
    input, select { padding: 10px; margin: 5px 0; width: 100%; box-sizing: border-box; }
    button { padding: 10px; background: #007AFF; color: white; border: none; border-radius: 5px; cursor: pointer; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { padding: 10px; border-bottom: 1px solid #ddd; }
    #login-screen, #dashboard { display: none; }
  </style>
</head>
<body>

<div id="login-screen" class="container" style="max-width:400px; text-align:center; display:block;">
  <h2>Admin Login</h2>
  <input type="text" id="u" placeholder="Username">
  <input type="password" id="p" placeholder="Password">
  <button onclick="login()">Login</button>
</div>

<div id="dashboard" class="container">
  <div style="display:flex; justify-content:space-between;">
    <h2>Manage Plans</h2>
    <button onclick="location.reload()" style="background:#333">Logout</button>
  </div>
  
  <div style="background:#f9f9f9; padding:15px; margin-top:20px;">
    <h3>Add/Edit Plan</h3>
    <input id="pid" placeholder="ID (e.g. mtn-1gb)">
    <div style="display:flex; gap:10px">
      <select id="pnet"><option value="mtn">MTN</option><option value="glo">Glo</option><option value="airtel">Airtel</option></select>
      <input id="papi" placeholder="Amigo Plan ID (e.g. 1001)">
    </div>
    <input id="pname" placeholder="Name (e.g. 1GB SME)">
    <input id="pprice" type="number" placeholder="Price">
    <button onclick="save()">Save Plan</button>
  </div>

  <table>
    <thead><tr><th>ID</th><th>Name</th><th>Price</th><th>API ID</th><th>Action</th></tr></thead>
    <tbody id="tbody"></tbody>
  </table>
</div>

<script>
  const CRED = {u:'AbdallahSauki', p:'Abdallah@2025'};
  let auth = '';

  function login() {
    if(document.getElementById('u').value === CRED.u && document.getElementById('p').value === CRED.p) {
      auth = 'Basic ' + btoa(CRED.u + ':' + CRED.p);
      document.getElementById('login-screen').style.display = 'none';
      document.getElementById('dashboard').style.display = 'block';
      load();
    } else alert('Invalid');
  }

  async function load() {
    const res = await fetch('/api/plans');
    const d = await res.json();
    document.getElementById('tbody').innerHTML = d.map(x => `
      <tr>
        <td>${x.id}</td><td>${x.network} ${x.name}</td><td>â‚¦${x.price}</td><td>${x.plan_id_api}</td>
        <td><button style="background:red; padding:5px" onclick="del('${x.id}')">Del</button></td>
      </tr>`).join('');
  }

  async function save() {
    const data = {
      action: 'create',
      id: document.getElementById('pid').value,
      network: document.getElementById('pnet').value,
      name: document.getElementById('pname').value,
      price: document.getElementById('pprice').value,
      plan_id_api: document.getElementById('papi').value
    };
    await fetch('/api/plans', { method: 'POST', headers: {'Content-Type':'application/json', 'Authorization': auth}, body: JSON.stringify(data) });
    load(); alert('Saved');
  }

  async function del(id) {
    if(confirm('Delete?')) {
      await fetch('/api/plans', { method: 'POST', headers: {'Content-Type':'application/json', 'Authorization': auth}, body: JSON.stringify({action:'delete', id}) });
      load();
    }
  }
</script>
</body>
</html>


